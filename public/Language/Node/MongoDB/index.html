<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MongoDB | 小羽</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/xiaoyu_blog/favicon.ico">
    <script language="javascript" type="text/javascript" src="/xiaoyu_blog/js/mouseClick.js"></script>
    <meta name="description" content="此心光明，亦复何言">
    <link rel="preload" href="/xiaoyu_blog/assets/css/0.styles.1e167897.css" as="style"><link rel="preload" href="/xiaoyu_blog/assets/js/app.d60b499b.js" as="script"><link rel="preload" href="/xiaoyu_blog/assets/js/2.ddd0c7b1.js" as="script"><link rel="preload" href="/xiaoyu_blog/assets/js/17.f80bb24f.js" as="script"><link rel="prefetch" href="/xiaoyu_blog/assets/js/10.474cbadc.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/11.c9fecf3c.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/12.09c2d5b0.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/13.5ec4dfef.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/14.3c1611eb.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/15.e5d903d9.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/16.043bfe03.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/18.057f96b7.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/19.f6b92b24.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/20.4a219353.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/3.40021c4d.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/4.78b12045.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/5.0ef5542d.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/6.905c52e3.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/7.622e689f.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/8.92e32dc3.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/9.2ff6146b.js">
    <link rel="stylesheet" href="/xiaoyu_blog/assets/css/0.styles.1e167897.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/xiaoyu_blog/" class="home-link router-link-active"><!----> <span class="site-name">小羽</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/xiaoyu_blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language" class="dropdown-title"><span class="title">Language</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Language/Node/Node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Language/JavaScript/JavaScript/" class="nav-link">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Vue/Vue_mvvm/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Axios/" class="nav-link">
  Axios
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/SSO/" class="nav-link">
  SSO
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Webpack2.0/" class="nav-link">
  Webpack2.0
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label=" Contact" class="dropdown-title"><span class="title"> Contact</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dingxingxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/dingxingxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客园
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/xiaoyu_blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language" class="dropdown-title"><span class="title">Language</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Language/Node/Node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Language/JavaScript/JavaScript/" class="nav-link">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Vue/Vue_mvvm/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Axios/" class="nav-link">
  Axios
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/SSO/" class="nav-link">
  SSO
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Webpack2.0/" class="nav-link">
  Webpack2.0
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label=" Contact" class="dropdown-title"><span class="title"> Contact</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dingxingxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/dingxingxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客园
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Language </span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Node</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xiaoyu_blog/Language/Node/Node/" class="sidebar-link">Node</a></li><li><a href="/xiaoyu_blog/Language/Node/MongoDB/" class="active sidebar-link">MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#_1、关于mongodb" class="sidebar-link">1、关于MongoDB</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#_2、mongodb的安装" class="sidebar-link">2、MongoDB的安装</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#_3、mongodb一些指令" class="sidebar-link">3、MongoDB一些指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#_3-1、常用指令" class="sidebar-link">3.1、常用指令</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#_3-2、查询语句" class="sidebar-link">3.2、查询语句</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#_3-3、修改语句" class="sidebar-link">3.3、修改语句</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#_3-4、删除语句" class="sidebar-link">3.4、删除语句</a></li></ul></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#node链接mongodb" class="sidebar-link">Node链接MongoDB</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#安装驱动" class="sidebar-link">安装驱动</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#创建数据库" class="sidebar-link">创建数据库</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#创建连接" class="sidebar-link">创建连接</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#数据库操作（curd）" class="sidebar-link">数据库操作（CURD）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#插入数据" class="sidebar-link">插入数据</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#查询数据" class="sidebar-link">查询数据</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#删除数据" class="sidebar-link">删除数据</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#排序" class="sidebar-link">排序</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#查询分页" class="sidebar-link">查询分页</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#删除集合" class="sidebar-link">删除集合</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/MongoDB/#lookup-实现左连接-多表查询" class="sidebar-link">$lookup 实现左连接(多表查询)</a></li></ul></li></ul></li><li><a href="/xiaoyu_blog/Language/Node/Reptiles%E7%88%AC%E8%99%AB/" class="sidebar-link">Reptiles爬虫</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Guide </span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mongodb"><a href="#mongodb" class="header-anchor">#</a> MongoDB</h1> <h2 id="_1、关于mongodb"><a href="#_1、关于mongodb" class="header-anchor">#</a> 1、关于MongoDB</h2> <p>MongoDB是面向文档型的数据库</p> <p>在MySQL里面我们是一个个的数据表，但是在MongoDB里面是一个个的集合，集合里面是一个个文档。</p> <p>在MySQL里面的数据表中是一行一行的数据，但是在MongoDB里面的文档是一个对象的集合，每个对象类似一行的数据。</p> <p>MongoDB是以键值对的形式保存数据的。</p> <h2 id="_2、mongodb的安装"><a href="#_2、mongodb的安装" class="header-anchor">#</a> 2、MongoDB的安装</h2> <p>在MongoDB的安装目录下的bin下有两个重要的程序。</p> <p><code>mongo.exe</code>和<code>mongod.exe</code></p> <p>其中<code>mogod.exe</code>是启动MongoDB的程序。程序启动后运行<code>mogo.exe</code>，然后就可以在特定的MongoDB命令行中执行指令进行数据的增删改查。</p> <p>MongoDB的启动指令：（E:\MobgoDB\data 自己存放数据库的位置）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">.</span>\mongod<span class="token punctuation">.</span>exe <span class="token operator">--</span>dbpath <span class="token constant">E</span><span class="token operator">:</span>\MobgoDB\data

<span class="token comment">// 然后运行</span>
mongo<span class="token punctuation">.</span>exe 就可以执行mongoDB的指令了
</code></pre></div><h2 id="_3、mongodb一些指令"><a href="#_3、mongodb一些指令" class="header-anchor">#</a> 3、MongoDB一些指令</h2> <h3 id="_3-1、常用指令"><a href="#_3-1、常用指令" class="header-anchor">#</a> 3.1、常用指令</h3> <div class="language-js extra-class"><pre class="language-js"><code>show dbs <span class="token comment">// 查看已经存在的数据库</span>

use 数据库名 <span class="token comment">// 切换到指定的数据库（无论数据是否存在 均可切换成功）</span>

db <span class="token comment">// 查看当前数据库</span>

db<span class="token punctuation">.</span><span class="token function">getCollectionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 查看当前数据库下一共有哪些文档集合</span>

db<span class="token punctuation">.</span>集合名<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>文档<span class="token punctuation">)</span> <span class="token comment">// 向指定的集合录入一条文档(如果不存在会自动创建)</span>
<span class="token comment">// 例如：db.user.insert({user:&quot;lol&quot;,age:18})</span>

db<span class="token punctuation">.</span>集合名<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>文档<span class="token number">1</span>，文档<span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 向指定的集合插入多条文档</span>
<span class="token comment">// 例如：db.suer.insert([{user:&quot;love&quot;,age:10},{user:&quot;noLove&quot;,age:20}])</span>

<span class="token comment">// 插入多条数据或单条数据的其他写法</span>
<span class="token comment">// db.集合名.insertMany([文档1，文档2])</span>
<span class="token comment">// db.集合名.insertOne(文档)</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>username<span class="token operator">:</span><span class="token string">&quot;马云&quot;</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">58</span><span class="token punctuation">,</span>height<span class="token operator">:</span><span class="token number">167</span><span class="token punctuation">,</span>friends<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;马化腾&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;许家印&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;雷军&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;李彦宏&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;柳传志&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>username<span class="token operator">:</span><span class="token string">&quot;许家印&quot;</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">52</span><span class="token punctuation">,</span>height<span class="token operator">:</span><span class="token number">177</span><span class="token punctuation">,</span>friends<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;马化腾&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;雷军&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;柳传志&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>username<span class="token operator">:</span><span class="token string">&quot;雷军&quot;</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">,</span>height<span class="token operator">:</span><span class="token number">174</span><span class="token punctuation">,</span>friends<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;马化腾&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;董明珠&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;柳传志&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>username<span class="token operator">:</span><span class="token string">&quot;雷德承&quot;</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span>height<span class="token operator">:</span><span class="token number">180</span><span class="token punctuation">,</span>friends<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;马化腾&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;王健林&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;柳传志&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>username<span class="token operator">:</span><span class="token string">&quot;王思聪&quot;</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">,</span>height<span class="token operator">:</span><span class="token number">179</span><span class="token punctuation">,</span>friends<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;林更新&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;林缓存&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;陈赫&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;雷军&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-2、查询语句"><a href="#_3-2、查询语句" class="header-anchor">#</a> 3.2、查询语句</h3> <blockquote><p>查询的方式都是以对象的形式查询的</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>集合名<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 查询指定的集合内所有数据</span>


<span class="token comment">// 查询指定字段</span>
db<span class="token punctuation">.</span>集合名<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>筛选条件<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>显示字段<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 显示字段</span>
<span class="token comment">// 显示user字段，不显示_id字段</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>user<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 1则显示该字段值，0则不显示该字段值</span>

<span class="token comment">// 筛选条件</span>
<span class="token comment">// 条件格式： 属性名：{条件操作符：值}</span>
<span class="token comment">// 条件操作符</span>
<span class="token comment">//		$gt：大于</span>
<span class="token comment">//		$gte：大于等于</span>
<span class="token comment">//		$lt：小于</span>
<span class="token comment">//		$lte：小于等于</span>
<span class="token comment">//		$in：包含其中任意一个 注意 $in操作符的值必须为数组类型</span>
<span class="token comment">//		$all：包含所有 $all操作符的值必须为数组类型</span>
<span class="token comment">//		$nin：不包含其中任意一个 $nin操作符的值必须为数组类型</span>
<span class="token comment">//		$ne：不等于</span>
<span class="token comment">//		$not：对已定于好的条件进行取反 {属性: {$not: {条件}}}</span>
<span class="token comment">//		$mod：取模（取余）   $mod: [x,y] 取所有除x雨y的值</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token punctuation">{</span>$gt<span class="token operator">:</span><span class="token number">35</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 筛选条件为年龄大于35</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>friends<span class="token operator">:</span><span class="token punctuation">{</span>$<span class="token keyword">in</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'林更新'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>，<span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 筛选条件为friends字段包含字段有林更新的。</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>friends<span class="token operator">:</span><span class="token punctuation">{</span>$<span class="token keyword">in</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'林更新'</span><span class="token punctuation">,</span><span class="token string">'雷军'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 筛序条件为friends字段有林更新或者有雷军的</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>friends<span class="token operator">:</span><span class="token punctuation">{</span>$all<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'马化腾'</span><span class="token punctuation">,</span><span class="token string">'雷军'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 筛选条件为friends字段同时包含马化腾和雷军</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>friends<span class="token operator">:</span><span class="token punctuation">{</span>$nin<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'马化腾'</span><span class="token punctuation">,</span><span class="token string">'雷军'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 筛选条件为friends字段不包含马化腾或者雷军</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 筛选条件为age为18的文档</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token punctuation">{</span>$ne<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 筛选条件为age不为18的文档</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token punctuation">{</span>$not<span class="token operator">:</span><span class="token punctuation">{</span>$gt<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 筛选条件为age不大于18</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token punctuation">{</span>$mod<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 筛选条件为age/3余数为0的文档</span>


<span class="token comment">// 模糊查询</span>
<span class="token comment">// https://blog.csdn.net/comhaqs/article/details/23822479</span>

<span class="token number">1</span>、db<span class="token punctuation">.</span>goods<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token regex">/joe/ig</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token number">2</span>、db<span class="token punctuation">.</span>goods<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token punctuation">{</span>$regex<span class="token operator">:</span><span class="token regex">/joe/ig</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token number">3</span>、db<span class="token punctuation">.</span>goods<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>goodsName<span class="token operator">:</span><span class="token punctuation">{</span>$regex<span class="token operator">:</span><span class="token string">'joe'</span><span class="token punctuation">,</span>$option<span class="token operator">:</span><span class="token string">'ig'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">&quot;joe&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ig&quot;</span><span class="token punctuation">)</span>
<span class="token number">4</span>、db<span class="token punctuation">.</span>goods<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>name<span class="token operator">:</span>reg<span class="token punctuation">)</span>
<span class="token number">5</span>、db<span class="token punctuation">.</span>goods<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token punctuation">{</span>$regex<span class="token operator">:</span>reg<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 以上5中写法均可</span>
</code></pre></div><p><strong>条件”且“和”或“</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 条件: 且</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>条件<span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>条件<span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// db.user.find({age:{$gt:25}},{friends:{$in:['雷军']}},{_id:0}) // age大于35并且friends中有雷军</span>

<span class="token comment">// 条件：或</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>$or<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>条件<span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>条件<span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token comment">// db.user.find({$or:[{age:{$gt:35}},{frineds:{$in:['雷军']}}]},{_id:0}) // age大于35或者friends中有雷军</span>

<span class="token comment">// 条件：且和或都有</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>条件<span class="token number">1</span><span class="token punctuation">,</span>$or<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>条件<span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>条件<span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 满足条件1，并且满足条件2或者条件3中的一个</span>
<span class="token comment">// db.user.find({age:{$gt:30},$or:[{height:{$lt:175}},{friends:{$in:[&quot;许家印&quot;]}]},{_id:0}) // age大于30，并且身高小于175或者friends中有许家印</span>
</code></pre></div><p><strong>其他条件操作</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">// 取满足条件的头n条数据</span>
<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">// 跳过n条数据再取数据</span>
<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 对满足条件的数据进行计数</span>
<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span>第一排序条件<span class="token punctuation">,</span>第二排序条件<span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 按照属性进行排序</span>
<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">// 跳过m条数据 再取头n条数据（调用顺序没有讲究，但是作用效果均为先条过数据再取数据）</span>

<span class="token comment">// 示例</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 取user集合中所有文档的前3个</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 取user集合中跳过前三个后取目前文档的前3个</span>
<span class="token comment">// 先排序再跳过在截取</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 按照age升序排列（正数为升序）</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 按照age降序排列（负数为降序）</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">din</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>height<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>height<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 按age升序排列，如果年龄相同，按身高升序排列</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token punctuation">{</span>$gt<span class="token operator">:</span><span class="token number">35</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>_id<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>count</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 统计age大于35的文档个数</span>

<span class="token comment">// 设计翻页的时候，一般会这么用</span>
db<span class="token punctuation">.</span>suer<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>y<span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-3、修改语句"><a href="#_3-3、修改语句" class="header-anchor">#</a> 3.3、修改语句</h3> <blockquote><p><code>db.集合名.update(query,{修改器: {属性:值}},option)</code></p> <p>option为可选参数，为对象类型，其下有两个属性：</p> <p>​	<code>multi</code>：布尔值，是否修改所有符合条件的数据，默认false</p> <p>​	<code>upsert</code>：布尔值，当没有符合条件的数据时，是否创建该数据，默认false</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 修改器</span>
<span class="token comment">//   $set：重新赋值</span>
<span class="token comment">// 	 $inc：对值进行叠加(值为正)或递减(值为负)适用于数字类型的值</span>
<span class="token comment">// 	 $unset：删除整个属性(包括属性名及属性值)</span>

<span class="token comment">// 数字修改器</span>
<span class="token comment">// 	 $push：给数组类型的值添加一个新元素</span>
<span class="token comment">// 	 $addToSet：给数组类型的值添加一个新元素（该方法不会重复添加已存在的值，同时也不会影响原来已经存在的重复值）</span>
<span class="token comment">// 	 $pop：从尾部删除一条数据（值的大小不会对结果产生影响 永远只会操作一条数据）（值为正 从尾部删除一条数据 值为负 从头部删除一条数据）</span>
<span class="token comment">// 	 $pull：按条件删除数据内元素  {$pull:{属性:值}} 删除指定值的元素</span>


<span class="token comment">// 示例</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token operator">:</span><span class="token string">'马云'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$<span class="token keyword">set</span><span class="token operator">:</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token number">55</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 设置马云文档的age为55</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token operator">:</span><span class="token string">'马云'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$inc<span class="token operator">:</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 设置马云的age在原来的基础上+2，如果是-2的话是减2</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token operator">:</span><span class="token string">'马云'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$unset<span class="token operator">:</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//  删除马云的age属性，这里age设置的值可以任意</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token operator">:</span><span class="token string">'马云'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$push<span class="token operator">:</span><span class="token punctuation">{</span>friends<span class="token operator">:</span><span class="token string">'Daotin'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 给马云的friends属性的最后增加一个值为'Daotin'</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token operator">:</span><span class="token string">'马云'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$pop<span class="token operator">:</span><span class="token punctuation">{</span>friends<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 给马云的friends属性从最后删除一个值。这里指令friends的值可随意。</span>
db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token operator">:</span><span class="token string">'王思聪'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$pull<span class="token operator">:</span><span class="token punctuation">{</span>friends<span class="token operator">:</span><span class="token string">'林更新'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 删除王思聪的friends属性中的林更新</span>
</code></pre></div><blockquote><p>注意：在默认情况下，修改操作只会操作第一条符合条件的数据。</p></blockquote> <h3 id="_3-4、删除语句"><a href="#_3-4、删除语句" class="header-anchor">#</a> 3.4、删除语句</h3> <blockquote><p><code>db.集合名.remove(query,option)</code></p> <p>option：为可选参数，为对象类型，拥有属性</p> <p><code>Justone</code>：是否只删除第一条符合条件的数据，默认false</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 示例</span>
dn<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span>user<span class="token operator">:</span><span class="token string">'lvonve'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 删除user属性值为lvonve的所有文档</span>
</code></pre></div><blockquote><p>注意：默认情况下 会删除所有符合条件的数据</p></blockquote> <p>MongoDB是一种文档导向数据库管理系统，有C++撰写而成</p> <p>如果你还没有MongoDB的基本知识，可以查看上方学习</p> <h2 id="node链接mongodb"><a href="#node链接mongodb" class="header-anchor">#</a> Node链接MongoDB</h2> <h2 id="安装驱动"><a href="#安装驱动" class="header-anchor">#</a> 安装驱动</h2> <div class="language-js extra-class"><pre class="language-js"><code>$ cnpm install mongodb
</code></pre></div><h2 id="创建数据库"><a href="#创建数据库" class="header-anchor">#</a> 创建数据库</h2> <p>要在MongoDB中创建一个数据库，首先我们需要创建一个MongoClient对象，然后配置好指定的url和端口号。</p> <p>如果数据库不存在。MongoDB将创建数据库并建立连接。</p> <h2 id="创建连接"><a href="#创建连接" class="header-anchor">#</a> 创建连接</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient<span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;mongodb://localhost:27017&quot;</span>

MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据库已创建'</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>useNewUrlParser,useUnifiedTopology是使用最新的url解析器，避免mongo报警告错误。</p> <hr> <h2 id="数据库操作（curd）"><a href="#数据库操作（curd）" class="header-anchor">#</a> 数据库操作（CURD）</h2> <p>与MySQL不同的是MongoDB会自动创建数据库和集合，所以使用前我们不需要手动去创建</p> <h3 id="插入数据"><a href="#插入数据" class="header-anchor">#</a> 插入数据</h3> <h4 id="插入一条数据"><a href="#插入一条数据" class="header-anchor">#</a> 插入一条数据</h4> <blockquote><p>insertOne()</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;mongodb://localhost:27017&quot;</span>

MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'xiaoyu'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> myobj <span class="token operator">=</span> <span class="token punctuation">{</span> username<span class="token operator">:</span><span class="token string">&quot;小羽&quot;</span><span class="token punctuation">,</span> type<span class="token operator">:</span><span class="token string">&quot;帅&quot;</span><span class="token punctuation">,</span>like<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'唱'</span><span class="token punctuation">,</span><span class="token string">'跳'</span><span class="token punctuation">,</span><span class="token string">'开车'</span><span class="token punctuation">,</span><span class="token string">'搞代码'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
    dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span>myobj<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文档插入成功'</span><span class="token punctuation">)</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="插入多条数据"><a href="#插入多条数据" class="header-anchor">#</a> 插入多条数据</h4> <blockquote><p>insertMany()</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MongoClinet <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;mongodb://localhost:27017&quot;</span>

MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> myobj <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token string">&quot;小羽&quot;</span><span class="token punctuation">,</span> type<span class="token operator">:</span> <span class="token string">&quot;帅&quot;</span><span class="token punctuation">,</span> like<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'唱'</span><span class="token punctuation">,</span> <span class="token string">'跳'</span><span class="token punctuation">,</span> <span class="token string">'开车'</span><span class="token punctuation">,</span> <span class="token string">'搞代码'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token string">&quot;吴亦凡&quot;</span><span class="token punctuation">,</span> type<span class="token operator">:</span> <span class="token string">&quot;帅&quot;</span><span class="token punctuation">,</span> like<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'唱'</span><span class="token punctuation">,</span> <span class="token string">'跳'</span><span class="token punctuation">,</span> <span class="token string">'大碗宽面'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token string">&quot;肖战&quot;</span><span class="token punctuation">,</span> type<span class="token operator">:</span> <span class="token string">&quot;帅&quot;</span><span class="token punctuation">,</span> like<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'唱'</span><span class="token punctuation">,</span> <span class="token string">'跳'</span><span class="token punctuation">,</span> <span class="token string">'爱粉丝'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
    dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span>myobj<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'插入的文档数量为：'</span><span class="token operator">+</span> res<span class="token punctuation">.</span>insertedCount<span class="token punctuation">)</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="查询数据"><a href="#查询数据" class="header-anchor">#</a> 查询数据</h3> <p>可以使用find()来查找数据，find()可以返回匹配条件的所有数据。如果未指定条件，find()返回集合中所有数据。</p> <h4 id="find"><a href="#find" class="header-anchor">#</a> find()</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;mongodb://localhost:27017/&quot;</span><span class="token punctuation">;</span>

MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'xiaoyu'</span><span class="token punctuation">)</span>
    dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 返回集合中所有数据</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="查询指定条件"><a href="#查询指定条件" class="header-anchor">#</a> 查询指定条件</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;mongodb://localhost:27017/&quot;</span><span class="token punctuation">;</span>
MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'xiaoyu'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> whereStr <span class="token operator">=</span> <span class="token punctuation">{</span>username<span class="token operator">:</span> <span class="token string">'小羽'</span><span class="token punctuation">}</span> <span class="token comment">// 查询条件</span>
    dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>whereStr<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="更新数据"><a href="#更新数据" class="header-anchor">#</a> 更新数据</h4> <h5 id="更新一条数据"><a href="#更新一条数据" class="header-anchor">#</a> 更新一条数据</h5> <blockquote><p>updateOne()</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;mongodb://localhost:27017/&quot;</span><span class="token punctuation">;</span>

MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'xiaoyu'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> whereStr <span class="token operator">=</span> <span class="token punctuation">{</span>username<span class="token operator">:</span> <span class="token string">'小羽'</span><span class="token punctuation">}</span> <span class="token comment">// 查询条件</span>
    <span class="token keyword">var</span> updateStr <span class="token operator">=</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小胖&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
    dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>whereStr<span class="token punctuation">,</span>updateStr<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文档更新成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h5 id="更新多条数据"><a href="#更新多条数据" class="header-anchor">#</a> 更新多条数据</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;mongodb://localhost:27017/&quot;</span><span class="token punctuation">;</span>

MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'xiaoyu'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> whereStr <span class="token operator">=</span> <span class="token punctuation">{</span>username<span class="token operator">:</span> <span class="token string">'小羽'</span><span class="token punctuation">}</span> <span class="token comment">// 查询条件</span>
    <span class="token keyword">var</span> updateStr <span class="token operator">=</span> <span class="token punctuation">{</span>$<span class="token keyword">set</span><span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'胸怀天下'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
    dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pudateMany</span><span class="token punctuation">(</span>whereStr<span class="token punctuation">,</span>updateStr<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>nModified <span class="token operator">+</span> <span class="token string">&quot; 条文档被更新&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="删除数据"><a href="#删除数据" class="header-anchor">#</a> 删除数据</h3> <h4 id="删除一条数据"><a href="#删除一条数据" class="header-anchor">#</a> 删除一条数据</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;mongodb://localhost:27017/&quot;</span><span class="token punctuation">;</span>

MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'xiaoyu'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> whereStr <span class="token operator">=</span> <span class="token punctuation">{</span>username<span class="token operator">:</span> <span class="token string">'小羽'</span><span class="token punctuation">}</span> <span class="token comment">// 查询条件</span>
    dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span>whereStr<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;文档删除成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="删除多条数据"><a href="#删除多条数据" class="header-anchor">#</a> 删除多条数据</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;mongodb://localhost:27017/&quot;</span><span class="token punctuation">;</span>

MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'xiaoyu'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> whereStr <span class="token operator">=</span> <span class="token punctuation">{</span>username<span class="token operator">:</span> <span class="token string">'小羽'</span><span class="token punctuation">}</span> <span class="token comment">// 查询条件</span>
    dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span>whereStr<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;文档删除成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="排序"><a href="#排序" class="header-anchor">#</a> 排序</h3> <p>排序使用sort()方法，该方法接受一个参数，规定是升序(1)还是降序(-1)</p> <p>例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token comment">// 按 type 字段升序</span>
<span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span> <span class="token comment">// 按 type 字段降序</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;mongodb://localhost:27017/&quot;</span><span class="token punctuation">;</span>

MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'xiaoyu'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> mysort <span class="token operator">=</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
    dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>mysort<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="查询分页"><a href="#查询分页" class="header-anchor">#</a> 查询分页</h3> <p>如果要设置指定的返回条数可以使用 <strong>limit()</strong> 方法，该方法只接受一个参数，指定了返回的条数。</p> <h4 id="limit"><a href="#limit" class="header-anchor">#</a> limit()</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;mongodb://localhost:27017/&quot;</span><span class="token punctuation">;</span>

MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'xiaoyu'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> mysort <span class="token operator">=</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
    dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="skip"><a href="#skip" class="header-anchor">#</a> skip()</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;mongodb://localhost:27017/&quot;</span><span class="token punctuation">;</span>

MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'xiaoyu'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> mysort <span class="token operator">=</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
    dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 跳过前面两条数据，读取两条数据</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="删除集合"><a href="#删除集合" class="header-anchor">#</a> 删除集合</h3> <p>我们可以使用drop()方法来删除集合</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;mongodb://localhost:27017/&quot;</span><span class="token punctuation">;</span>

MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>db</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'xiaoyu'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> mysort <span class="token operator">=</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
    dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 跳过前面两条数据，读取两条数据</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="lookup-实现左连接-多表查询"><a href="#lookup-实现左连接-多表查询" class="header-anchor">#</a> $lookup 实现左连接(多表查询)</h3> <p>创建集合 orders</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient<span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;mongodb://localhost:27017/&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> product_id<span class="token operator">:</span> <span class="token number">154</span><span class="token punctuation">,</span> status<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> db</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">&quot;xiaoyu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;文档插入成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>创建集合 product</p> <div class="language-js extra-class"><pre class="language-js"><code>MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> db</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">&quot;xiaoyu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> myobj <span class="token operator">=</span>  <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token number">154</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'笔记本电脑'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token number">155</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'耳机'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token number">156</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'台式电脑'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;products&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span>myobj<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;插入的文档数量为: &quot;</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>insertedCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用$lookup查询</p> <div class="language-js extra-class"><pre class="language-js"><code>MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> db</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  <span class="token keyword">var</span> dbo <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">&quot;xiaoyu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dbo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      $lookup<span class="token operator">:</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'products'</span><span class="token punctuation">,</span>            <span class="token comment">// 右集合</span>
        localField<span class="token operator">:</span> <span class="token string">'product_id'</span><span class="token punctuation">,</span>    <span class="token comment">// 左集合 join 字段</span>
        foreignField<span class="token operator">:</span> <span class="token string">'_id'</span><span class="token punctuation">,</span>         <span class="token comment">// 右集合 join 字段</span>
        <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">'orderdetails'</span>           <span class="token comment">// 新生成字段（类型array）</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// [{&quot;_id&quot;:1,&quot;product_id&quot;:154,&quot;status&quot;:1,&quot;orderdetails&quot;:[{&quot;_id&quot;:154,&quot;name&quot;:&quot;笔记本电脑&quot;}]}]</span>
    db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/xiaoyu_blog/Language/Node/Node/" class="prev">
        Node
      </a></span> <span class="next"><a href="/xiaoyu_blog/Language/Node/Reptiles%E7%88%AC%E8%99%AB/">
        Reptiles爬虫
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/xiaoyu_blog/assets/js/app.d60b499b.js" defer></script><script src="/xiaoyu_blog/assets/js/2.ddd0c7b1.js" defer></script><script src="/xiaoyu_blog/assets/js/17.f80bb24f.js" defer></script>
  </body>
</html>
