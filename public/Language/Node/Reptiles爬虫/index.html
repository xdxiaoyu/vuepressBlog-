<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Reptiles爬虫 | 小羽</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/xiaoyu_blog/favicon.ico">
    <script language="javascript" type="text/javascript" src="/xiaoyu_blog/js/mouseClick.js"></script>
    <meta name="description" content="婷婷袅袅十三余，豆蔻梢头二月初">
    <link rel="preload" href="/xiaoyu_blog/assets/css/0.styles.377b39b4.css" as="style"><link rel="preload" href="/xiaoyu_blog/assets/js/app.04d90341.js" as="script"><link rel="preload" href="/xiaoyu_blog/assets/js/2.0c3dc4c5.js" as="script"><link rel="preload" href="/xiaoyu_blog/assets/js/11.1b94ee20.js" as="script"><link rel="prefetch" href="/xiaoyu_blog/assets/js/10.8a904c81.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/12.f1f7a0e5.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/13.38f235f8.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/14.4e98b21f.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/15.9309f0f7.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/16.f6915983.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/17.1ea56815.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/18.14b86352.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/3.22c99b79.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/4.6e0b2219.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/5.7117a645.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/6.b5999823.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/7.aaef4281.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/8.b30e1d81.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/9.8eeddebf.js">
    <link rel="stylesheet" href="/xiaoyu_blog/assets/css/0.styles.377b39b4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/xiaoyu_blog/" class="home-link router-link-active"><!----> <span class="site-name">小羽</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/xiaoyu_blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language" class="dropdown-title"><span class="title">Language</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Language/Node/Node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Language/JavaScript/JavaScript/" class="nav-link">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool" class="dropdown-title"><span class="title">Tool</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Tool/Vue/Vue_mvvm/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Tool/Axios/" class="nav-link">
  Axios
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Tool/SSO/" class="nav-link">
  SSO
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Tool/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Tool/Webpack/" class="nav-link">
  Webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label=" Contact" class="dropdown-title"><span class="title"> Contact</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dingxingxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/dingxingxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客园
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/xiaoyu_blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language" class="dropdown-title"><span class="title">Language</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Language/Node/Node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Language/JavaScript/JavaScript/" class="nav-link">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool" class="dropdown-title"><span class="title">Tool</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Tool/Vue/Vue_mvvm/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Tool/Axios/" class="nav-link">
  Axios
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Tool/SSO/" class="nav-link">
  SSO
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Tool/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Tool/Webpack/" class="nav-link">
  Webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label=" Contact" class="dropdown-title"><span class="title"> Contact</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dingxingxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/dingxingxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客园
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Language </span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Node</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xiaoyu_blog/Language/Node/Node/" class="sidebar-link">Node</a></li><li><a href="/xiaoyu_blog/Language/Node/MongoDB/" class="sidebar-link">MongoDB</a></li><li><a href="/xiaoyu_blog/Language/Node/Reptiles%E7%88%AC%E8%99%AB/" aria-current="page" class="active sidebar-link">Reptiles爬虫</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/Reptiles%E7%88%AC%E8%99%AB/#cheerio" class="sidebar-link">cheerio</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/Reptiles%E7%88%AC%E8%99%AB/#puppeteer" class="sidebar-link">Puppeteer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/Reptiles%E7%88%AC%E8%99%AB/#使用和例子" class="sidebar-link">使用和例子</a></li></ul></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/Reptiles%E7%88%AC%E8%99%AB/#爬虫总结" class="sidebar-link">爬虫总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/Reptiles%E7%88%AC%E8%99%AB/#_1-爬虫介绍" class="sidebar-link">1.爬虫介绍</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/Reptiles%E7%88%AC%E8%99%AB/#_2-爬虫流程" class="sidebar-link">2.爬虫流程</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/Reptiles%E7%88%AC%E8%99%AB/#_3-请求数据的库" class="sidebar-link">3.请求数据的库</a></li></ul></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Language/Node/Reptiles%E7%88%AC%E8%99%AB/#demo" class="sidebar-link">Demo</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tool </span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="reptiles爬虫"><a href="#reptiles爬虫" class="header-anchor">#</a> Reptiles爬虫</h1> <h2 id="cheerio"><a href="#cheerio" class="header-anchor">#</a> cheerio</h2> <p><strong>简介:</strong></p> <blockquote><p>cheerio是node.js的抓取页面模块，为服务器特别定制的，快速、灵活、实施的jQuery核心实现。适合各种web爬虫程序。</p></blockquote> <p><strong><a href="https://cheerio.js.org/" target="_blank" rel="noopener noreferrer">cheerios官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong></p> <p><strong>爬取斗图啦网站图片例子</strong>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token comment">// cheerio 获取HTML文档的内容，内容的获取跟jquery一样</span>

<span class="token comment">// 起始地址-分析网站结构</span>
<span class="token keyword">let</span> httpUrl <span class="token operator">=</span> <span class="token string">&quot;https://www.doutula.com/article/list/?page=1&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 获取页面总数</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>httpUrl<span class="token punctuation">)</span>
  <span class="token keyword">let</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token keyword">let</span> btnLength <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.pagination li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token keyword">let</span> allNum <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.pagination li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>btnLength <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>allNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> allNum
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">spider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取所有页面的总数</span>
  <span class="token keyword">let</span> allPageNum <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span> <span class="token number">50</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">getListPage</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getListPage</span><span class="token punctuation">(</span><span class="token parameter">pageNum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> httpUrl <span class="token operator">=</span> <span class="token string">&quot;https://www.doutula.com/article/list/?page=&quot;</span> <span class="token operator">+</span> pageNum<span class="token punctuation">;</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>httpUrl<span class="token punctuation">)</span>
  <span class="token comment">// cheerio解析html文档</span>
  <span class="token keyword">let</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token comment">// 获取当前页面的所有的表情页面的链接</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#home .col-sm-9&gt;a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> pageUrl <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.random_title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> reg <span class="token operator">=</span> <span class="token regex">/(.*?)\d/igs</span><span class="token punctuation">;</span>
    title <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./img/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功创建目录：'</span> <span class="token operator">+</span> <span class="token string">'./img/'</span> <span class="token operator">+</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">parsePage</span><span class="token punctuation">(</span>pageUrl<span class="token punctuation">,</span> title<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">parsePage</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> title</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
  <span class="token keyword">let</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.pic-content img'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> imgUrl <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
    <span class="token comment">// 获取扩展名</span>
    <span class="token keyword">let</span> extName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>imgUrl<span class="token punctuation">)</span>
    <span class="token comment">// 图片写入的路径和名字</span>
    <span class="token keyword">let</span> imgPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./img/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>extName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token comment">// 创建图片可写流</span>
    <span class="token keyword">let</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>imgPath<span class="token punctuation">)</span>
    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>imgUrl<span class="token punctuation">,</span> <span class="token punctuation">{</span> responseType<span class="token operator">:</span> <span class="token string">'stream'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 通过管道流入到可写流的来源流</span>
      res<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'图片加载完成:'</span><span class="token punctuation">,</span> imgPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// res.data.on('close',() =&gt; {</span>
      <span class="token comment">//   ws.close()</span>
      <span class="token comment">// })</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">spider</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>爬取音乐网站下载音乐:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 目标：下载音乐</span>
<span class="token comment">// 1获取音乐相关的信息，通过音乐相关的信息获取mp3地址</span>
<span class="token comment">// 2如何获取大量的音乐信息，通过获取音乐列表</span>
<span class="token comment">// 3通过音乐的分类页，获取音乐列表</span>

<span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token comment">// 获取音乐</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getPage</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> httpUrl <span class="token operator">=</span> <span class="token string">&quot;http://www.app-echo.com/api/recommend/sound-day?page=&quot;</span> <span class="token operator">+</span> num
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>httpUrl<span class="token punctuation">)</span>

  res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> title <span class="token operator">=</span> item<span class="token punctuation">.</span>sound<span class="token punctuation">.</span>name
    <span class="token keyword">let</span> mp3Url <span class="token operator">=</span> item<span class="token punctuation">.</span>sound<span class="token punctuation">.</span>source
    <span class="token keyword">let</span> filename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>mp3Url<span class="token punctuation">)</span><span class="token punctuation">.</span>name

    <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mp3Url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span>
    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'music.txt'</span><span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token punctuation">{</span>flag<span class="token operator">:</span><span class="token string">'a'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入完成：'</span><span class="token operator">+</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// console.log(title);</span>
    <span class="token comment">// console.log(mp3Url);</span>
    <span class="token function">download</span><span class="token punctuation">(</span>mp3Url<span class="token punctuation">,</span>filename<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 下载音乐</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token parameter">mp3Url<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>mp3Url<span class="token punctuation">,</span> <span class="token punctuation">{</span> responseType<span class="token operator">:</span> <span class="token string">&quot;stream&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 创建可写流</span>
  <span class="token keyword">let</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'./mp3/'</span> <span class="token operator">+</span> filename <span class="token operator">+</span> <span class="token string">'.mp3'</span><span class="token punctuation">)</span>
  <span class="token comment">// 通过管道流入到可写流的来源流</span>
  res<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span>
  <span class="token comment">// res.data.on('close',() =&gt; {</span>
  <span class="token comment">//   ws.close()</span>
  <span class="token comment">// })</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">getPage</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="puppeteer"><a href="#puppeteer" class="header-anchor">#</a> Puppeteer</h2> <p><strong>出现的背景</strong></p> <p>Chrome59(linux、macos)、Chrome60(windows)之后，Chrome自带headless(无界面)模式很方便做自动化测试或者爬虫。但是如何和headless模式的Chrome交互则是一个问题。通过启动Chrome时的命令参行参仅能实现简易的启动时初始化操作。Selenium、Webdriver等是一种解决方案，但是往往依赖众多，不够扁平。</p> <p>Puppteer是谷歌官方出品的一个通过DevTools协议控制headless Chrome的库。通过Puppeteer的提供api直接控制Chrome模拟大部分用户操作来进行UI Test或者作为爬虫访问页面来收集数据。</p> <p><strong>作用：</strong></p> <ul><li>生成页面的屏幕截图和PDF。</li> <li>爬取SPA（单页应用程序）并生成预渲染的内容（即“ SSR”（服务器端渲染））。</li> <li>自动化表单提交，UI测试，键盘输入等。</li> <li>创建最新的自动化测试环境。使用最新的JavaScript和浏览器功能，直接在最新版本的Chrome中运行测试。</li> <li>捕获站点的<a href="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/reference" target="_blank" rel="noopener noreferrer">时间线跟踪<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以帮助诊断性能问题。</li> <li>测试Chrome扩展程序。</li></ul> <h3 id="使用和例子"><a href="#使用和例子" class="header-anchor">#</a> 使用和例子</h3> <p>Puppeteer类似其他框架，通过操作Browser实例来操作浏览器做出相应的反应。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">'http://rennaiqian.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">screenshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>path<span class="token operator">:</span><span class="token string">'example.png'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">pdf</span><span class="token punctuation">(</span><span class="token punctuation">{</span>path<span class="token operator">:</span><span class="token string">'example.pdf'</span><span class="token punctuation">,</span>format<span class="token operator">:</span><span class="token string">'A4'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>上述代码通过puppeteer的launch方法生成了一个browser的实例，对应于浏览器，launch方法可以传入配置选项，比较有用的是在本地调试时传入<code>{headless:false}</code>可以关闭headless模式。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>headless<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>browser.newPage方法可以打开一个新选项卡并返回选项卡的实例page，通过page上的各种方法可以对页面进行常用操作。上述代码就进行了截屏和打印pdf的操作。</p> <h2 id="爬虫总结"><a href="#爬虫总结" class="header-anchor">#</a> 爬虫总结</h2> <h3 id="_1-爬虫介绍"><a href="#_1-爬虫介绍" class="header-anchor">#</a> 1.爬虫介绍</h3> <p>通过模拟浏览器的请求，服务器根据我们的请求返回我们想要的数据，将数据解析出来，并且进行保存</p> <h3 id="_2-爬虫流程"><a href="#_2-爬虫流程" class="header-anchor">#</a> 2.爬虫流程</h3> <h4 id="_1-目标：确定你想要获取的数据"><a href="#_1-目标：确定你想要获取的数据" class="header-anchor">#</a> 1-目标：确定你想要获取的数据</h4> <ol><li><p>确定想要的数据在什么页面</p></li> <li><p>确定在哪些页面可以链接到这些页面</p></li> <li><p>寻找页面之间和数据之间的规律</p> <h4 id="_2-分析页面"><a href="#_2-分析页面" class="header-anchor">#</a> 2-分析页面</h4></li> <li><p>获取数据的方法（正则，cherrio）</p></li> <li><p>分析数据是通过ajax请求的数据，还是html里自带的数据</p></li> <li><p>如果是通过AjAX请求的数据，那么需要获取ajax请求的链接，一般请求到的数据都为JSON格式数据，那么就容易解析</p></li> <li><p>如果数据在HTML里面，那么就用cherrio通过选择器将内容选中</p> <h4 id="_3-编写单个数据获取的案例"><a href="#_3-编写单个数据获取的案例" class="header-anchor">#</a> 3-编写单个数据获取的案例</h4></li> <li><p>解析出分类页的链接地址</p></li> <li><p>解析出列表页的链接地址</p></li> <li><p>解析出详情页的链接地址</p></li> <li><p>解析详情页里面想要获取的数据</p></li> <li><p>将数据进行保存到本地或者是数据库</p> <h4 id="_4-如果遇到阻碍进行反爬虫对抗"><a href="#_4-如果遇到阻碍进行反爬虫对抗" class="header-anchor">#</a> 4-如果遇到阻碍进行反爬虫对抗</h4></li> <li><p>User-Agent是否是正常浏览器的信息</p></li> <li><p>将请求头设置成跟浏览器一样的内容</p></li> <li><p>因为爬虫的爬取速度过快，会导致封ip。1那么可以降低速度进行解决，2可以使用代理进行解决</p></li> <li><p>如果设置需要凭证，那么可以采用无界面浏览器真实模拟。</p></li></ol> <h3 id="_3-请求数据的库"><a href="#_3-请求数据的库" class="header-anchor">#</a> 3.请求数据的库</h3> <p>request，axiso：通过库，帮助我们快速实现HTTP请求包的打包</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'请求地址'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   <span class="token string">'请求头字段'</span><span class="token operator">:</span><span class="token string">'请求头的value值'</span>         
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 处理返回的内容 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>axios优势会更明显，前后端通杀，前后端调用方式一致</p> <div class="language-js extra-class"><pre class="language-js"><code>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'请求地址'</span><span class="token punctuation">,</span> 参数对象<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>axios获取图片</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">'http://bit.ly/2mTM3ny'</span><span class="token punctuation">,</span>
    responseType<span class="token operator">:</span> <span class="token string">'stream'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'ada_lovelace.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>puppeteer：完全模拟浏览器</strong></p> <p>打开浏览器</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    headless<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否是无界面浏览器</span>
    slowMo<span class="token operator">:</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token comment">// 调试时可以减慢操作速度</span>
    defaultViewport<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//设置视宽的宽高</span>
        width<span class="token operator">:</span> <span class="token number">1200</span>
        height<span class="token operator">:</span> <span class="token number">800</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    timeout<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token comment">// 默认超时时间3秒</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><p>打开新标签页</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> page <span class="token operator">=</span> <span class="token keyword">await</span> borwser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>获取所有浏览器中的页面</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">pages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>关闭浏览器</p> <div class="language-js extra-class"><pre class="language-js"><code>borwser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>将页面跳转至</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
</code></pre></div><p>获取页面的对象并进行操作</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> btn <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
<span class="token keyword">let</span> input <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
<span class="token comment">// 点击按钮</span>
btn<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 聚焦到输入框</span>
input<span class="token punctuation">.</span><span class="token function">forcus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>在页面上写入内容或者键盘按键</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">await</span> page<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> page<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span><span class="token function">press</span><span class="token punctuation">(</span><span class="token string">'ArrowLeft'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> page<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span><span class="token function">down</span><span class="token punctuation">(</span><span class="token string">'Shift'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>截获页面请求</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setRequestInterception</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token parameter">request</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// request 包含请求的所有信息</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>你想要的条件<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        request<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        request<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        	status<span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">,</span>
        	contentType<span class="token operator">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">,</span>
        	body<span class="token operator">:</span> <span class="token string">'Not Found!'</span>
    	<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>获取浏览器的信息和内容</p> <div class="language-js extra-class"><pre class="language-js"><code>page<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> item <span class="token punctuation">}</span><span class="token punctuation">)</span>
page<span class="token punctuation">.</span><span class="token function">$$eval</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> item <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="demo"><a href="#demo" class="header-anchor">#</a> Demo</h2> <p><strong>GitHub上有：<a href="https://github.com/dingxingxing/MongoDB-ReptilesDemo" target="_blank" rel="noopener noreferrer">MongoDB数据库+Node爬虫-案例demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，欢迎Clone学习</strong></p> <p><strong>更多爬虫相关小案例，欢迎进入<a href="https://github.com/dingxingxing/Storage-of-record-documents" target="_blank" rel="noopener noreferrer">github选择&quot;爬虫-Reptiles爬虫&quot;文件夹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>查看clone</strong></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/xiaoyu_blog/assets/js/app.04d90341.js" defer></script><script src="/xiaoyu_blog/assets/js/2.0c3dc4c5.js" defer></script><script src="/xiaoyu_blog/assets/js/11.1b94ee20.js" defer></script>
  </body>
</html>
