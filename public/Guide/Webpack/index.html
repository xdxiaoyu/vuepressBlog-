<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack | 小羽</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/xiaoyu_blog/favicon.ico">
    <script language="javascript" type="text/javascript" src="/xiaoyu_blog/js/mouseClick.js"></script>
    <meta name="description" content="此心光明，亦复何言">
    <link rel="preload" href="/xiaoyu_blog/assets/css/0.styles.377b39b4.css" as="style"><link rel="preload" href="/xiaoyu_blog/assets/js/app.46baccfe.js" as="script"><link rel="preload" href="/xiaoyu_blog/assets/js/2.0c3dc4c5.js" as="script"><link rel="preload" href="/xiaoyu_blog/assets/js/12.a7864445.js" as="script"><link rel="prefetch" href="/xiaoyu_blog/assets/js/10.7970aac1.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/11.daf2b723.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/13.dafb327a.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/14.df0aaf05.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/15.0cf1dec4.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/16.2e7e1dea.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/17.2ff004d5.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/18.77c71cad.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/3.22c99b79.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/4.3e0333c7.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/5.7117a645.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/6.83ee3653.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/7.3267bfd7.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/8.df59288d.js"><link rel="prefetch" href="/xiaoyu_blog/assets/js/9.16a15e80.js">
    <link rel="stylesheet" href="/xiaoyu_blog/assets/css/0.styles.377b39b4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/xiaoyu_blog/" class="home-link router-link-active"><!----> <span class="site-name">小羽</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/xiaoyu_blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language" class="dropdown-title"><span class="title">Language</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Language/Node/Node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Language/JavaScript/JavaScript/" class="nav-link">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Vue/Vue_mvvm/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Axios/" class="nav-link">
  Axios
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/SSO/" class="nav-link">
  SSO
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Webpack/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label=" Contact" class="dropdown-title"><span class="title"> Contact</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dingxingxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/dingxingxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客园
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/xiaoyu_blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language" class="dropdown-title"><span class="title">Language</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Language/Node/Node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Language/JavaScript/JavaScript/" class="nav-link">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Vue/Vue_mvvm/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Axios/" class="nav-link">
  Axios
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/SSO/" class="nav-link">
  SSO
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/xiaoyu_blog/Guide/Webpack/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label=" Contact" class="dropdown-title"><span class="title"> Contact</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dingxingxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/dingxingxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客园
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Language </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Guide </span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xiaoyu_blog/Guide/Vue/Vue_mvvm/" class="sidebar-link">对Vue中的MVVM原理解析和实现</a></li><li><a href="/xiaoyu_blog/Guide/Vue/Vuex/" class="sidebar-link">Vuex原理解析</a></li><li><a href="/xiaoyu_blog/Guide/Vue/Vue_base/" class="sidebar-link">Vue必会基础</a></li></ul></section></li><li><a href="/xiaoyu_blog/Guide/Axios/" class="sidebar-link">Axios</a></li><li><a href="/xiaoyu_blog/Guide/SSO/" class="sidebar-link">SSO</a></li><li><a href="/xiaoyu_blog/Guide/Git/" class="sidebar-link">Git</a></li><li><a href="/xiaoyu_blog/Guide/Webpack/" aria-current="page" class="active sidebar-link">Webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#一、初识webpack" class="sidebar-link">一、初识Webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#webpack安装步骤" class="sidebar-link">webpack安装步骤</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#webpack配置文件" class="sidebar-link">webpack配置文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#二、webpack核心概念" class="sidebar-link">二、Webpack核心概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#loader" class="sidebar-link">loader</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#静态资源打包" class="sidebar-link">静态资源打包:</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#file-loader" class="sidebar-link">file-loader</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#url-loader" class="sidebar-link">url-loader</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#plugins" class="sidebar-link">Plugins</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#entry和output" class="sidebar-link">entry和output</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#sourcemap" class="sidebar-link">sourceMap</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#webpackdevserver" class="sidebar-link">WebpackDevServer</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#hotmodulereplacementplugin" class="sidebar-link">HotModuleReplacementPlugin</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#babel" class="sidebar-link">babel</a></li></ul></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#三、webpack进阶" class="sidebar-link">三、Webpack进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#tree-shaking" class="sidebar-link">Tree Shaking</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#develoment和production模式的区分打包" class="sidebar-link">Develoment和Production模式的区分打包</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#code-splitting-代码分割" class="sidebar-link">Code Splitting(代码分割)</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#lazy-loading" class="sidebar-link">Lazy Loading</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#chunk是什么" class="sidebar-link">Chunk是什么</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#打包分析" class="sidebar-link">打包分析</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#preloading" class="sidebar-link">Preloading</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#prefetching" class="sidebar-link">Prefetching</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#shimming" class="sidebar-link">Shimming</a></li></ul></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#四、webpack实战配置案例讲解" class="sidebar-link">四、Webpack实战配置案例讲解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#library" class="sidebar-link">library</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#plugin-钩子函数" class="sidebar-link">plugin-钩子函数</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#typescript的打包配置" class="sidebar-link">TypeScript的打包配置</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#使用webpackdevserver实现请求转发" class="sidebar-link">使用webpackDevServer实现请求转发</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#bundler-源码编写-dependencies-graph" class="sidebar-link">Bundler 源码编写(Dependencies Graph)</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#eslint-在webpack中的配置" class="sidebar-link">Eslint 在webpack中的配置</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#提升webpack打包速度的方法" class="sidebar-link">提升Webpack打包速度的方法</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#多页面打包配置" class="sidebar-link">多页面打包配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#五、webpack-底层原理及脚手架工具分析" class="sidebar-link">五、Webpack 底层原理及脚手架工具分析</a></li><li class="sidebar-sub-header"><a href="/xiaoyu_blog/Guide/Webpack/#六、create-react-app-和-vue-cli-3-0脚手架工具配置分析" class="sidebar-link">六、Create-React-App 和 Vue-Cli 3.0脚手架工具配置分析</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack"><a href="#webpack" class="header-anchor">#</a> Webpack</h1> <h2 id="一、初识webpack"><a href="#一、初识webpack" class="header-anchor">#</a> 一、初识Webpack</h2> <h3 id="webpack安装步骤"><a href="#webpack安装步骤" class="header-anchor">#</a> webpack安装步骤</h3> <p>初始化项目 <code>npm init</code></p> <h4 id="一、全局安装-global"><a href="#一、全局安装-global" class="header-anchor">#</a> 一、全局安装(global)</h4> <div class="language-js extra-class"><pre class="language-js"><code>npm install webpack webpack<span class="token operator">-</span>cli <span class="token operator">-</span>g

<span class="token comment">// 非常不推荐全局安装webpack</span>
<span class="token comment">// 假设我有两个项目，都用webpack打包，如果我全局安装webpack，webpack版本号是固定的就是现在的4.44.2。但假设我的一个项目是通过webpack3进行配置的，另一个项目才是通过webpack4进行配置的。如果全局安装的版本是4.44.2，那就意味着webpack3这个项目肯定是运行不起来的。</span>
<span class="token comment">// 要解决这个问题，卸载webpack4，在再装webpack。当然全局安装以后没有办法同时启用两个项目。</span>
</code></pre></div><h4 id="二、局部安装-local"><a href="#二、局部安装-local" class="header-anchor">#</a> 二、局部安装(local)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在当前文件目录下</span>
npm install webpack webpack<span class="token operator">-</span>cli <span class="token operator">-</span><span class="token constant">D</span>

webpack <span class="token operator">-</span>v
<span class="token comment">// 此时  讲无法输出版本号</span>

npx webpack <span class="token operator">-</span>v
<span class="token comment">// npx 会从当前目录的node_modules文件夹里寻找webpack</span>
</code></pre></div><h3 id="webpack配置文件"><a href="#webpack配置文件" class="header-anchor">#</a> webpack配置文件</h3> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token comment">// node核心模块path两个小知识点复习</span>
<span class="token comment">// __dirname：获取当前执行文件所在目录的完整目录名</span>
<span class="token comment">// path.resolve()：把路径或者路径片段的序列解析为一个绝对路径</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



<span class="token comment">// webpack指定配置文件进行打包 例：此时配置文件为-- webpackconfig.js</span>
npx webpack <span class="token operator">--</span>config webpackconfig<span class="token punctuation">.</span>js

<span class="token comment">// 安装webpack-cli的作用</span>
使得我们可以在命令行里运行webpack或者npx这样的指令
</code></pre></div><p><strong>webpack小考核 0_0</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>webpack是什么：webpack的核心概念是一个模块打包工具，他的主要作用是将各类文件打包在一起。打包后的文件作用于浏览器中。

模块是什么：在模块化编程中，开发者将程序分解成离散的功能块。

webpack的配置文件作用是什么 ：webpack打包会走默认配置，写了配置文件可以让打包按自己写的相关配置进行打包处理。

</code></pre></div><h2 id="二、webpack核心概念"><a href="#二、webpack核心概念" class="header-anchor">#</a> 二、Webpack核心概念</h2> <h3 id="loader"><a href="#loader" class="header-anchor">#</a> loader</h3> <p>webpack不能识别非js结尾的后缀的模块，需要让webpack识别出来其他后缀模块</p> <p>其实loader就是一个打包的方案。</p> <p>ex:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex">/\.jpg$/</span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">'file-loader'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="静态资源打包"><a href="#静态资源打包" class="header-anchor">#</a> 静态资源打包:</h3> <h3 id="file-loader"><a href="#file-loader" class="header-anchor">#</a> <code>file-loader</code></h3> <p><a href="https://www.webpackjs.com/loaders/file-loader/" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex">/\.(jpg|png|gif)$/</span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token comment">// placeholder 占位符</span>
                    name<span class="token operator">:</span> <span class="token string">'[name]_[hash].[ext]'</span><span class="token punctuation">,</span>
                    outputhPath<span class="token operator">:</span> <span class="token string">'images/'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="url-loader"><a href="#url-loader" class="header-anchor">#</a> <code>url-loader</code></h3> <p>官方文档</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex">/\.(jpg|png|gif)$/</span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    name<span class="token operator">:</span> <span class="token string">'[name]_[hash].[ext]'</span><span class="token punctuation">,</span>
                    outputhPath<span class="token operator">:</span> <span class="token string">'images/'</span><span class="token punctuation">,</span>
                    limit<span class="token operator">:</span> <span class="token number">20480</span><span class="token punctuation">,</span> <span class="token comment">// 小于限制字节大小时打包成base64格式，大于则输出到指定文件夹通过http请求获取</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="plugins"><a href="#plugins" class="header-anchor">#</a> Plugins</h3> <blockquote><p>plugin 可以在webpack运行到某个时刻的时候，帮你做一些事情。（类似于Vue，react里面的生命周期函数）</p></blockquote> <h4 id="htmlwebpackplugin"><a href="#htmlwebpackplugin" class="header-anchor">#</a> <code>HtmlWebpackPlugin</code></h4> <blockquote><p>HtmlWebpackPlugin 会在打包结束后，自动生成一个html文件，并把打包生成的js文件自动引入到这个HTML文件中</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> webpackConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'index_bundle.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> webpackConfig<span class="token punctuation">;</span>
</code></pre></div><h4 id="cleanwebpackplugin"><a href="#cleanwebpackplugin" class="header-anchor">#</a> <code>CleanWebpackPlugin</code></h4> <blockquote><p>此插件将output.path在每次成功重建后删除webpack目录中的所有文件以及所有为使用的webpack资产。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> webpackConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'index_bundle.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
     <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
         protectWebpackAssets<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 允许删除当前打包文件的资源（默认是true-不允许）</span>
  	 <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> webpackConfig<span class="token punctuation">;</span>
</code></pre></div><h3 id="entry和output"><a href="#entry和output" class="header-anchor">#</a> entry和output</h3> <p>多文件打包配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    emntry<span class="token operator">:</span> <span class="token punctuation">{</span>
        main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
        sub<span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex">/\.(jpg|png|gif)$/</span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    name<span class="token operator">:</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span>_<span class="token punctuation">[</span>hash<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token punctuation">,</span>
            	    outputPath<span class="token operator">:</span> <span class="token string">'images/'</span><span class="token punctuation">,</span>
            		limit<span class="token operator">:</span> <span class="token number">20480</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span> <span class="token string">'src/index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            protectWebpackAssets<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        publicPath<span class="token operator">:</span> <span class="token string">'http://cdn.com.cn'</span><span class="token punctuation">,</span>  <span class="token comment">// 按需加载外部资源</span>
        <span class="token comment">// 打包后的文件 &lt;script src=&quot;http://cdn.com.cn/main.js&quot;&gt;</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">reslove</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 打包后文件：</span>
<span class="token comment">// &lt;script src=&quot;http://cdn.com.cn/main.js&quot;&gt;&lt;/script&gt;</span>
<span class="token comment">// &lt;script src=&quot;http://cdn.com.cn/sub.js&quot;&gt;&lt;/script&gt;&lt;/body&gt;</span>
</code></pre></div><h3 id="sourcemap"><a href="#sourcemap" class="header-anchor">#</a> sourceMap</h3> <blockquote><p>sourceMap 它是一个映射关系， 映射打包后文件出错的地方对应实际项目文件错误的位置</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-eval-source-map'</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="webpackdevserver"><a href="#webpackdevserver" class="header-anchor">#</a> WebpackDevServer</h3> <blockquote><p>提高开发效率，不需要每次更改代码都重新输入命令启动服务</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
        contebtBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span> <span class="token comment">// 告诉服务器从哪里提供内容。只有你想要提供静态文件时才需要。</span>
        open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 自动打开浏览器访问地址</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>借助node和webpack中间件实现WebpackDevServer</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpackDevMiddleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-middleware'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.config'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> complier <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// webpackDevMiddleware 中间件，可以监听webpack打包代码发生的变化</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">webpackDevMiddleware</span><span class="token punctuation">(</span>complier<span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server is running'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="hotmodulereplacementplugin"><a href="#hotmodulereplacementplugin" class="header-anchor">#</a> HotModuleReplacementPlugin</h3> <blockquote><p>插件实现热更新</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
        contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
        open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        hotOnle<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在入口文件中配置文件更改后需要更新的操作</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./number.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">getElemntById</span><span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">)</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElmentById</span><span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>   
<span class="token punctuation">}</span>
</code></pre></div><h3 id="babel"><a href="#babel" class="header-anchor">#</a> babel</h3> <blockquote><p>babel将ES6语法转ES5</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token comment">// exclude 排出在外的模块</span>
    	<span class="token punctuation">{</span>
      		test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span> loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
             options<span class="token operator">:</span> <span class="token punctuation">{</span>
        	   <span class="token string">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> useBuiltIns<span class="token operator">:</span> <span class="token string">'usage'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
 			<span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>低版本的浏览器没有ES6的新语法，还需要补充</p> <div class="language-js extra-class"><pre class="language-js"><code>npm install <span class="token operator">--</span>save @babel<span class="token operator">/</span>polyfill


<span class="token comment">// 在打包主文件的头部引入</span>
<span class="token keyword">import</span> <span class="token string">&quot;@babel/polyfill&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p><a href="https://www.babeljs.cn/docs/babel-polyfill" target="_blank" rel="noopener noreferrer">polyfill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span> loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>options<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 业务代码使用</span>
        <span class="token string">&quot;preset&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            targets<span class="token operator">:</span> <span class="token punctuation">{</span>
                chrome<span class="token operator">:</span> <span class="token string">'67'</span><span class="token punctuation">,</span> <span class="token comment">// 打包会运行在67版本上的浏览器</span>
            <span class="token punctuation">}</span>，
            useBuiltIns<span class="token operator">:</span> <span class="token string">'usage'</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 这是通过全局注入方式变量，会造成全局污染</span>
</code></pre></div><p>编写UI组件库，可以通过另一种发生打包ES6文件避免造成全局污染</p> <blockquote><p>@babel/plugin-transform-runtime</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>
   <span class="token comment">// 不会污染全局，已闭包的形式注入，适合编写UI组件库或者库的时候使用</span>
       <span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;absoluteRuntime&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token string">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 不配置不会把es6语法打包进去</span>
          <span class="token string">&quot;helpers&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string">&quot;regenerator&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string">&quot;useESModules&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token string">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;7.0.0-beta.0&quot;</span>
        <span class="token punctuation">}</span>
 <span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre></div><p>还可以通过<code>.babelrc</code>文件将<code>options</code>里面的配置项写入进去，避免<code>options</code>对象特别长冗余</p> <h2 id="三、webpack进阶"><a href="#三、webpack进阶" class="header-anchor">#</a> 三、Webpack进阶</h2> <h3 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> Tree Shaking</h3> <blockquote><p>你可以将应用程序想象成一棵树。绿色表示实际用到的源码和 library，是树上活的树叶。灰色表示无用的代码，是秋天树上枯萎的树叶。为了除去死去的树叶，你必须摇动这棵树，使它们落下。</p> <p>删除模块中“未引用代码”，只支持ES Module的引入，这是因为<code>import</code>这种ES的模块引入底层是一个静态引入的方式，而Commdjs底层是动态引入。而Tree Shaking只支持静态方式的引入</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
     usedExports<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// webpack.config.js文件</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
    
<span class="token comment">// package.json文件</span>
</code></pre></div><p>会遇见的问题：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'@babel/polyfill'</span> 
<span class="token comment">// 当你引入babel/polyfill时，实际上并未导出任何内容，他是直接在window对象上绑定Promise等等..</span>
<span class="token comment">// 当Tree Shaking 进行打包的时候发现没有任何导出内容很可能就会直接忽略掉，但实际上是需要的。使用Tree Shaking就会忽略会导致报错</span>
<span class="token comment">// 解决方案： 在package.json文件中写入-</span>
<span class="token string">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/polyfill&quot;</span><span class="token punctuation">]</span>
<span class="token comment">// 如果没有特殊处理直接写false</span>

<span class="token keyword">import</span> <span class="token string">'./style.css'</span>
<span class="token comment">// 当引入css文件时，同理</span>
<span class="token comment">// 解决方案：在package.json文件中写入</span>
<span class="token string">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*.css&quot;</span><span class="token punctuation">]</span>

</code></pre></div><h3 id="develoment和production模式的区分打包"><a href="#develoment和production模式的区分打包" class="header-anchor">#</a> Develoment和Production模式的区分打包</h3> <blockquote><p>差异：</p> <p>develoment环境中，sorcemap是非常全的，可以快速定位问题。不压缩</p> <p>production环境中，被压缩，sorcemap比较简单的映射关系</p></blockquote> <h4 id="webpack-merge"><a href="#webpack-merge" class="header-anchor">#</a> webpack-merge</h4> <div class="language-js extra-class"><pre class="language-js"><code>公用的内容可以引入至 webpack<span class="token punctuation">.</span>common<span class="token punctuation">.</span>js中
</code></pre></div><blockquote><p>webpack.dev.js</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> merge <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common.js'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> devConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">'cheap-module-eval-source-map'</span><span class="token punctuation">,</span> <span class="token comment">// production环境下使用cheap-module-source-map</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
    open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 自动打开浏览器访问地址</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// hotOnly: true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// production 环境打包时，下方代码可以注释</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    usedExports<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> devConfig<span class="token punctuation">)</span>

</code></pre></div><blockquote><p>webpack.prod.js</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> merge <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> commonCofig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common.js'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span> <span class="token comment">// production环境下使用cheap-module-source-map</span>

  <span class="token comment">// 线上打包可以去掉</span>
  <span class="token comment">// devServer: {</span>
  <span class="token comment">//   contentBase: './dist',</span>
  <span class="token comment">//   open: true, // 自动打开浏览器访问地址</span>
  <span class="token comment">//   hot: true,</span>
  <span class="token comment">//   hotOnly: true</span>
  <span class="token comment">// },</span>

  <span class="token comment">// production 环境打包时，下方代码可以注释</span>
  <span class="token comment">// optimization: {</span>
  <span class="token comment">//   usedExports: true</span>
  <span class="token comment">// },</span>

<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonCofig<span class="token punctuation">,</span> prodConfig<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>webpack.common.js</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// node核心模块path两个小知识点复习</span>
<span class="token comment">// __dirname：或取当前执行文件所在目录的完整目录名</span>
<span class="token comment">// path.resolve()：把路径或者路径片段的序列解析为一个绝对路径</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex">/\.(jpg|png|gif)$/</span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// loader: 'file-loader',</span>
        <span class="token comment">// options: {</span>
        <span class="token comment">//   // placeholder 占位符</span>
        <span class="token comment">//   name: '[name]_[hash].[ext]',</span>
        <span class="token comment">//   outputPath: 'images/'</span>
        <span class="token comment">// }</span>
        loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'[name]_[hash].[ext]'</span><span class="token punctuation">,</span>
          outputPath<span class="token operator">:</span> <span class="token string">'images/'</span><span class="token punctuation">,</span>
          limit<span class="token operator">:</span> <span class="token number">20480</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
        <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// exclude 排出在外的模块</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span> loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token comment">// options: 将放入.babelrc中 </span>
      <span class="token comment">// {</span>
      <span class="token comment">//   // 业务代码使用</span>
      <span class="token comment">//   // &quot;presets&quot;: [[&quot;@babel/preset-env&quot;, {</span>
      <span class="token comment">//   //   targets: {</span>
      <span class="token comment">//   //     chrome: '67', // 打包会运行在67版本的上的浏览器</span>
      <span class="token comment">//   //     safari: '11.1', // 同理</span>
      <span class="token comment">//   //   },</span>
      <span class="token comment">//   //   useBuiltIns: 'usage'</span>
      <span class="token comment">//   // }]]</span>
      <span class="token comment">//   &quot;plugins&quot;: [[</span>
      <span class="token comment">//     // 不会污染全局，已闭包的形式注入，适合编写UI组件库或者库的时候使用</span>
      <span class="token comment">//     &quot;@babel/plugin-transform-runtime&quot;,</span>
      <span class="token comment">//     {</span>
      <span class="token comment">//       &quot;absoluteRuntime&quot;: false,</span>
      <span class="token comment">//       &quot;corejs&quot;: 2, // 不配置不会把es6语法打包进去</span>
      <span class="token comment">//       &quot;helpers&quot;: true,</span>
      <span class="token comment">//       &quot;regenerator&quot;: true,</span>
      <span class="token comment">//       &quot;useESModules&quot;: false,</span>
      <span class="token comment">//       &quot;version&quot;: &quot;7.0.0-beta.0&quot;</span>
      <span class="token comment">//     }</span>
      <span class="token comment">//   ]]</span>
      <span class="token comment">// }</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// publicPath: '/',</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="code-splitting-代码分割"><a href="#code-splitting-代码分割" class="header-anchor">#</a> Code Splitting(代码分割)</h3> <blockquote><p>webpack和Code Splitting的关系</p> <p>无关</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack中实现代码分割，两种方式</span>

<span class="token comment">// 1.同步代码：只需要再webpack.common.js中做optimization的配置</span>
<span class="token comment">// 2.异步代码：无需任何设置，会自动进行代码分割，放置到新的文件中</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
         optimization<span class="token operator">:</span> <span class="token punctuation">{</span> splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span> chunks<span class="token operator">:</span> <span class="token string">'all'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> 
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="splitchunks"><a href="#splitchunks" class="header-anchor">#</a> SplitChunks</h4> <blockquote><p>SplitChunksPlugin参数配置</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
         optimization<span class="token operator">:</span> <span class="token punctuation">{</span> 
           splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span> 
                chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span> <span class="token comment">// 针对同步和异步代码都做分割。initial-同步代码 async-异步代码</span>
                minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// 引入库大于当前数值30000kb，才做代码分割</span>
                minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 打包生成的chunk文件，有几个引用了这个模块，小于当前数值将不进行分割（当一个模块被用了至少多少次的时候才进行代码分割）</span>
                maxAsyncRequests<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 按需加载时的最大并行请求数，超过将不进分割</span>
                maxInitialRequest<span class="token punctuation">;</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 入口点的最大并行数</span>
                automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span> <span class="token comment">// 生成文件名连接符</span>
                enforceSizeThreshold<span class="token operator">:</span> <span class="token number">50000</span><span class="token punctuation">,</span> <span class="token comment">// 强制执行拆分的大小阈值和其他限制</span>
                cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 缓存组。同时引入两个第三方模块，使用cacheGroups可以让两个模块打包在一个js文件中</span>
                	vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
                	   test<span class="token operator">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>
                	   priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// default和vendors都满足时，哪个priority值大就会被打包到哪个组里</span>
                	   filename<span class="token operator">:</span> <span class="token string">'vendors.js'</span> <span class="token comment">// 允许覆盖文件名</span>
                	<span class="token punctuation">}</span><span class="token punctuation">,</span>
    			   <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                       priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
                       reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 已打包过的 模块再次在其他模块中被使用时，将不会重复打包</span>
                       filename<span class="token operator">:</span> <span class="token string">'common.js'</span>
                   <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
 		<span class="token punctuation">}</span> 
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="lazy-loading"><a href="#lazy-loading" class="header-anchor">#</a> Lazy Loading</h3> <blockquote><p>Lazy Loading（懒加载）其实并不是webpack里面的模块，是ECMAScript里面的，本质关系不大。webpack只是能识别import这种语法进行代码分割</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Lazy Loading</span>
<span class="token keyword">function</span> <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/*webpackChunkName:&quot;lodash&quot;*/</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> _<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElemnet</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
        element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'DEll'</span><span class="token punctuation">,</span> <span class="token string">'Lee'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> element
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">element</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// 同async-await优化</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> _ <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/*webpackChunkName:&quot;lodash&quot;*/</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">creteElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
    element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Dell'</span><span class="token punctuation">,</span> <span class="token string">'Lee'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> element
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">element</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="chunk是什么"><a href="#chunk是什么" class="header-anchor">#</a> Chunk是什么</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Chunk</span>
<span class="token comment">// 每一个打包出来的js文件都是chunk</span>
</code></pre></div><h3 id="打包分析"><a href="#打包分析" class="header-anchor">#</a> 打包分析</h3> <blockquote><p>当我们使用webpack进行代码的打包之后，我们可以借助打包分析的一些工具。来对打包后的文件进行一定的分析，然后来看一下它打包是否合理</p> <p>打包分析工具github地址: https://github.com/webpack-contrib/webpack-bundle-analyzer</p> <p>配置代码为： <code>webpack --profile --json &gt; stats.json</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在package.json文件中加入</span>
<span class="token comment">// 未加入打包生成json文件分析代码</span>
<span class="token string">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev-build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config ./build/webpack.dev.js&quot;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 加入以后</span>
<span class="token string">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev-build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --profile --json &gt; stats.json --config ./build/webpack.dev.js&quot;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打包会生成 stats.json文件，可在上述github网站提供的-analyse下面地址，进行打包工具分析</span>
</code></pre></div><p>除了上述地址可以分析打包后的文件，webpack官网还提供了其他社区支持：https://webpack.js.org/guides/code-splitting/#bundle-analysis</p> <h3 id="preloading"><a href="#preloading" class="header-anchor">#</a> Preloading</h3> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPreloading: true */</span> <span class="token string">'./click.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token keyword">default</span><span class="token operator">:</span> func<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 会和主的业务文件一起去加载。所以用下面是webpack使用更优的一种方式</span>
</code></pre></div><h3 id="prefetching"><a href="#prefetching" class="header-anchor">#</a> Prefetching</h3> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPrefetch: true */</span> <span class="token string">'./click.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token keyword">default</span><span class="token operator">:</span> func<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 会等待核心代码加载完成之后，页面宽空闲的时候，再去加载‘webpackPrefetch’对应的js文件。</span>
<span class="token comment">// 浏览器可能会存在兼容性问题</span>
</code></pre></div><h3 id="shimming"><a href="#shimming" class="header-anchor">#</a> Shimming</h3> <blockquote><p><code>webpack</code> 编译器(compiler)能够识别遵循 ES2015 模块语法、CommonJS 或 AMD 规范编写的模块。然而，一些第三方的库(library)可能会引用一些全局依赖（例如 <code>jQuery</code> 中的 <code>$</code>）。这些库也可能创建一些需要被导出的全局变量。这些“不符合规范的模块”就是 <em>shimming</em> 发挥作用的地方。</p></blockquote> <p>jquery.ui.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">ui</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'background'</span><span class="token punctuation">,</span> <span class="token function">_join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'green'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 报错 Uncaught ReferenceError: $ is not defined</span>
<span class="token comment">// 因为一个模块和另一个模块变量是隔离的</span>
<span class="token comment">// 需要直接引入  import $ from 'jquery'</span>
<span class="token comment">// 如果使用第三方的库，不可能去修改源码，此时就需要使用webpack解决这个问题</span>
</code></pre></div><p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ui <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./jquery.ui'</span>
<span class="token function">ui</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> dom <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;div&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dom<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'----'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">'cheap-module-eval-source-map'</span><span class="token punctuation">,</span> <span class="token comment">// production环境下使用cheap-module-source-map</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
    open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 自动打开浏览器访问地址</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    hotOnly<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex">/\.(jpg|png|gif)$/</span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'[name]_[hash].[ext]'</span><span class="token punctuation">,</span>
          outputPath<span class="token operator">:</span> <span class="token string">'images/'</span><span class="token punctuation">,</span>
          limit<span class="token operator">:</span> <span class="token number">10240</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// exclude 排出在外的模块</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
      exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// new BundleAnalyzerPlugin()  注释打包分析 </span>
    <span class="token comment">// 此处添加 ProvidePlugin 方法可解决上述 `jquery.ui.js` 文件的报错</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      $<span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span> <span class="token comment">// 当发现你的一个模块里用了$这个字符串，就会在这个模块中导入jquery这个库</span>
      _join<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">,</span> <span class="token string">'join'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'main.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="四、webpack实战配置案例讲解"><a href="#四、webpack实战配置案例讲解" class="header-anchor">#</a> 四、Webpack实战配置案例讲解</h2> <h3 id="library"><a href="#library" class="header-anchor">#</a> library</h3> <blockquote><p>第三方库如何配置被引用</p></blockquote> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    externals<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span> <span class="token comment">// lodash在打包库的时候，不打包到库的代码里去，而是让业务代码加载。</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'library.js'</span><span class="token punctuation">,</span>
        
        <span class="token comment">// 不管你通过任何形式引入这个库，都能让你引入到</span>
        libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
        <span class="token comment">// ex: import libary from 'library'</span>
        <span class="token comment">//     const library = require('library')</span>
        <span class="token comment">//     require(['library'], function() {})</span>
        
        <span class="token comment">// 想用 &lt;script src='library.js'&gt;&lt;/script&gt;这种方式引入，全局使用library.math等等</span>
        library<span class="token operator">:</span> <span class="token string">'library'</span><span class="token punctuation">,</span> <span class="token comment">// 可命名为其他字符串</span>
        <span class="token comment">// 打包生成的代码挂载到一个页面的全局变量'library',配置了一个'library'参数</span>
        
        <span class="token comment">// libraryTarget: 'this' // 'window'</span>
        <span class="token comment">// 将'library'挂载到this对象或者window上，此时不支持'umd'的引入模块方式</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="plugin-钩子函数"><a href="#plugin-钩子函数" class="header-anchor">#</a> plugin-钩子函数</h3> <p>Plugin-插件什么时候有效？我们打包的某些时刻里面你想做一些事情，这个时候是插件生效的时刻。</p> <p>copyright-webpack-plugin.js</p> <div class="language-js extra-class"><pre class="language-js"><code>Class CopyrightWebpackPlugin <span class="token punctuation">{</span>
    <span class="token comment">// constructor(options) {</span>
       <span class="token comment">// console.log('插件被使用了',options);</span>
	<span class="token comment">//}</span>
<span class="token punctuation">}</span>

<span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// compiler - 存放打包所有相关的内容</span>
    <span class="token comment">// 钩子。 emit: 生成资源到 output 目录之前。</span>
    <span class="token comment">// tapAsync:  接收两个参数， 这个plugin的名字和回调函数</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">'CopyrightWebpackPlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">debugger</span>
        <span class="token comment">// compilation - 存放这次打包的相关内容</span>
        compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span><span class="token string">'copyright.txt'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token function-variable function">source</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token string">'copyright by dell lee'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">size</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token number">21</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compile<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'CopyrightWebpackPlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'compiler'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> CopyrightWebpackPlugin
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> CopyrightWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./plugin/copyright-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugin<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">CopyrightWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'dell'</span> <span class="token comment">// 传参调试使用（并不是官方配置参数）</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].js'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>package.json</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;plugin&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 两个命令干的事情是一样的，第一种可以传入node的参数进去</span>
    <span class="token property">&quot;debug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node --inspect --inspect-brk node_modules/webpack/bin/webpack.js&quot;</span><span class="token punctuation">,</span>
     <span class="token comment">// --inspect: 我要开启node的调试工具</span>
     <span class="token comment">// --inspect-brk: 我在运行webpack.js做调试的时候，在webpack执行的时候在第一行打上一个断点</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.11.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.2.0&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="typescript的打包配置"><a href="#typescript的打包配置" class="header-anchor">#</a> TypeScript的打包配置</h3> <p><code>index.ts</code></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>

<span class="token comment">// 对于第三方库，在ts文件中引用。如果想要库在调用方法时给予调用的错误警告，需要安装这个库的类型文件</span>
<span class="token comment">// 例如上述： npm install @type/lodash --save-dev</span>

Class Greeter <span class="token punctuation">{</span>
    greeting<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token operator">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>greeting <span class="token operator">=</span> message
    <span class="token punctuation">}</span>
    <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello,'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>greeting<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> greeter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeter</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'greeter.greet()'</span><span class="token punctuation">)</span>
</code></pre></div><p><code>webpack.config.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code>cosnt path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
	entry<span class="token operator">:</span> <span class="token string">'./src/index.ts'</span><span class="token punctuation">,</span>
	module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex">/\.ts?$/</span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token string">'ts-loader'</span><span class="token punctuation">,</span> <span class="token comment">// 这个loader打包时需要一个tsconfig.json文件。里面配置了对ts打包的配置项。</span>
            exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filname<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>tsconfig.json</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;compilerOptiuons&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;outDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es6&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 我们使用的是esmodule引入模块的方式即(import)</span>
        <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es5&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 打包生成文件的语法类型</span>
        <span class="token property">&quot;allowJs&quot;</span><span class="token operator">:</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 允许在ts文件中引用js的模块</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用webpackdevserver实现请求转发"><a href="#使用webpackdevserver实现请求转发" class="header-anchor">#</a> 使用webpackDevServer实现请求转发</h3> <p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;@babel/polyfill&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDom <span class="token keyword">from</span> <span class="token string">'react-dom'</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/react/api/header.json'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'结果: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Hello World<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>getElementById<span class="token punctuation">)</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-eval-source-map'</span><span class="token punctuation">,</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
        contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
        open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        port<span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
        hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        hotOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'/react/api'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                target<span class="token operator">:</span> <span class="token string">'http://www.dell-lee.com'</span><span class="token punctuation">,</span>
                pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string">'header.json'</span><span class="token operator">:</span> <span class="token string">'demo.json'</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                secure<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 请求如果转发到https上，需要配置这个参数为false</span>
                <span class="token function-variable function">bypass</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> proxyOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 如果你请求html路径的接口，直接跳过转发，返回对应路径下的index.html或false(该返回啥返回啥，不走代理)</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>accept<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Skipping proxy for browser request.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token string">'/index.html'</span><span class="token punctuation">;</span> <span class="token comment">// return false</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 可以突破网站对orgin的限制</span>
                header<span class="token operator">:</span> <span class="token punctuation">{</span>
                  host<span class="token operator">:</span> <span class="token string">'www.dell-lee.com'</span><span class="token punctuation">,</span>
          		  cookie<span class="token operator">:</span> <span class="token string">'sdfasa'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span> <span class="token string">'src/index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">CleanWeboackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">Webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="bundler-源码编写-dependencies-graph"><a href="#bundler-源码编写-dependencies-graph" class="header-anchor">#</a> Bundler 源码编写(Dependencies Graph)</h3> <hr> <h3 id="eslint-在webpack中的配置"><a href="#eslint-在webpack中的配置" class="header-anchor">#</a> Eslint 在webpack中的配置</h3> <blockquote><p>安装</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> eslint-webpack-plugin --save-dev
<span class="token function">npm</span> <span class="token function">install</span> eslint --save-dev
</code></pre></div></blockquote> <p>用法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ESLintPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'eslint-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">ESLintPlugin</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="提升webpack打包速度的方法"><a href="#提升webpack打包速度的方法" class="header-anchor">#</a> 提升Webpack打包速度的方法</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1</span>、跟上技术的迭代（Node，Npm，Yarn）
<span class="token number">2</span>、在尽可能少的模块上应用Loader
<span class="token number">3</span>、Plugin尽可能精简并确保可靠
<span class="token number">5</span>、使用DllPlugin提高打包速度
<span class="token number">6</span>、控制包文件大小
<span class="token number">7</span>、多进程打包 <span class="token operator">--</span> thread<span class="token operator">-</span>loader<span class="token punctuation">,</span>parallel<span class="token operator">-</span>webpack<span class="token punctuation">,</span>happyack
<span class="token number">8</span>、合理使用sourceMap
<span class="token number">9</span>、结合stats分析打包结果
<span class="token number">10</span>、开发环境内存编译（无用插件剔除）
</code></pre></div><h3 id="多页面打包配置"><a href="#多页面打包配置" class="header-anchor">#</a> 多页面打包配置</h3> <h2 id="五、webpack-底层原理及脚手架工具分析"><a href="#五、webpack-底层原理及脚手架工具分析" class="header-anchor">#</a> 五、Webpack 底层原理及脚手架工具分析</h2> <h4 id="_1、如何编写一个loader"><a href="#_1、如何编写一个loader" class="header-anchor">#</a> 1、如何编写一个Loader</h4> <p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code>consoel<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'heloo dell'</span><span class="token punctuation">)</span>
</code></pre></div><p>loaders/replaceLoader.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">export</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> option <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOption</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token comment">// return source.replace('dell', option.name)</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'dell'</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 可以同步或异步调用以返回多个结果的函数</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>
    err<span class="token operator">:</span> Error <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> string <span class="token operator">|</span> Buffer<span class="token punctuation">,</span> <span class="token comment">// 源代码进来，解析过后新的代码</span>
    sourceMap<span class="token operator">?</span><span class="token operator">:</span> SourceMap<span class="token punctuation">,</span> <span class="token comment">// 打包sourceMap信息</span>
    meta<span class="token operator">?</span><span class="token operator">:</span> any <span class="token comment">// 额外想往外传递的信息</span>
<span class="token punctuation">)</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex">/\.js/</span><span class="token punctuation">,</span>
            <span class="token comment">// use: [path.resolve(__dirname, './loaders/replaceLoader.js')]</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    loader<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./loaders/replaceLoader.js'</span><span class="token punctuation">)</span>
                    options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    	name<span class="token operator">:</span> <span class="token string">'xiaoYu'</span>
                	<span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> dist<span class="token punctuation">)</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].js'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2、如何编写一个plugin"><a href="#_2、如何编写一个plugin" class="header-anchor">#</a> 2、如何编写一个Plugin</h4> <blockquote><p>是webpack源码中80%都是基于Plugin机制编写的,可以说Plugin它的灵魂。（实例见4-plugin-钩子函数）</p></blockquote> <h4 id="_3、bundler源码编写（模块分析）"><a href="#_3、bundler源码编写（模块分析）" class="header-anchor">#</a> 3、Bundler源码编写（模块分析）</h4> <p><code>./src/word.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> word <span class="token operator">=</span> <span class="token string">'hello'</span>
</code></pre></div><p><code>./src/message.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> word <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./word.js'</span>
<span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">say</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>word<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">export</span> <span class="token keyword">default</span> message
</code></pre></div><p><code>./src/index.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> message <span class="token keyword">from</span> <span class="token string">'./message.js'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
</code></pre></div><p><code>./bundle.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/parser'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@bable/traverse'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default
<span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@bable/core'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">moduleAnalyser</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    cosnt content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token comment">/* 打印出来的是抽象语法树（AST）
    console.log(parser.parse(content, {
    	sourceType: 'module'
    }));
    */</span>
    <span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        sourceType<span class="token operator">:</span> <span class="token string">'module'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> dependencise <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function">ImportDeclaration</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> node <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>filname<span class="token punctuation">)</span>
            <span class="token keyword">const</span> newFile <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dirname<span class="token punctuation">,</span> node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
            dependencies<span class="token punctuation">[</span>node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token punctuation">]</span> <span class="token operator">=</span> newFile
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> bable<span class="token punctuation">.</span><span class="token function">transformFromAst</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token keyword">null</span> <span class="token punctuation">,</span> <span class="token punctuation">{</span>
        presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span> <span class="token comment">// 插件的集合</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">,</span>
        dependencies<span class="token punctuation">,</span>
        code
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 写一个函数分析模块</span>
<span class="token comment">// 读取文件内容，把文件内容转换成js对象</span>
<span class="token comment">// 采用babel的parser把字符串转换成抽象语法树</span>
<span class="token comment">// 分析语法树的引用声明和依赖内容</span>
<span class="token comment">// 用键值对存储依赖关系的路径</span>
<span class="token comment">// 对模块的源码进行了一次编译(从es-module即es6的语法编译成浏览器能识别的语法)</span>
<span class="token comment">// </span>

cosnt <span class="token function-variable function">makeDependenciesGraph</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> entryModule <span class="token operator">=</span> <span class="token function">moduleAnalyser</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span>
    <span class="token keyword">const</span> graphArray <span class="token operator">=</span> <span class="token punctuation">[</span> entryModule <span class="token punctuation">]</span> <span class="token comment">// 依赖图谱</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> graphArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> item <span class="token operator">=</span> graphArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> dependencies <span class="token punctuation">}</span> <span class="token operator">=</span> item
        <span class="token keyword">if</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token keyword">in</span> dependencies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               graphArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">moduleAnalyser</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">const</span> graph <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    graphArray<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        graph<span class="token punctuation">[</span>item<span class="token punctuation">.</span>filename<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            dependencies<span class="token operator">:</span> item<span class="token punctuation">.</span>dependencies<span class="token punctuation">,</span>
            code<span class="token operator">:</span> item<span class="token punctuation">.</span>code
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> graph
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">generateCode</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(makeDependenciesGraph(entyr)); 缺少一个require方法和export对象</span>
    <span class="token keyword">const</span> graph <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringfy</span><span class="token punctuation">(</span><span class="token function">makeDependenciesGraph</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
	  (function(graph){
		function require(module){
		   function loaclRequire(relativePath) {
			  return require(graph[module].dependencies[relativePath]) 
		   }
		   var exports = {}
		   (function(require, exports, code){
				eval(code)
			})(localRequire, exports, graph[module].code);
			return exports
		};
		require('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entry<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')
	  })(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>graph<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)
	</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token function">generateCOde</span><span class="token punctuation">(</span><span class="token string">'./src/index.js'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="六、create-react-app-和-vue-cli-3-0脚手架工具配置分析"><a href="#六、create-react-app-和-vue-cli-3-0脚手架工具配置分析" class="header-anchor">#</a> 六、Create-React-App 和 Vue-Cli 3.0脚手架工具配置分析</h2> <blockquote><p>VueCli对webpack的做了一些底层的封装，所以即使不会webpack也可以通过阅读VueCli官网快速的完成或更改配置，当然Vue也暴露了一个参数，可以编写原生的webpack配置</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    configureWebpack： <span class="token punctuation">{</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/xiaoyu_blog/Guide/Git/" class="prev">
        Git
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/xiaoyu_blog/assets/js/app.46baccfe.js" defer></script><script src="/xiaoyu_blog/assets/js/2.0c3dc4c5.js" defer></script><script src="/xiaoyu_blog/assets/js/12.a7864445.js" defer></script>
  </body>
</html>
